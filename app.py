# from aws_lambda_powertools import Tracer
# from aws_lambda_powertools.utilities.typing import LambdaContext
import base64
import os

import pdfkit

# tracer = Tracer()

def convert_html_to_pdf(html_content):
    current_file_directory = os.path.dirname(os.path.abspath(__file__))
    LIB_DIR = os.path.abspath("./bin/wkhtmltopdf")

    print(f"LIB_DIR: {LIB_DIR}")

    pdf = pdfkit.from_string(
        html_content,
        False,
        configuration=pdfkit.configuration(wkhtmltopdf=LIB_DIR),
    )

    print("PDF CREADO")

    base64_pdf = base64.b64encode(pdf).decode("utf-8")

    return base64_pdf




# @tracer.capture_lambda_handler
def handler(event: dict, context: dict) -> dict:
    print(event)
    return convert_html_to_pdf(event["html_content"])



data = {
  "html_content": "<html style=\"background: #E3E3E3;margin: 5px;\">\r\n<head>\r\n    <title>Notificaciones Grupo Mutual</title>\r\n    <meta charset=\"UTF-8\"/>\r\n    <!--[if gte mso 9]>\r\n    <style>\r\n        #tableForOutlook {\r\n            width:800px;\r\n            border-collapse: collapse;\r\n            color: #6b6b6b;\r\n            font-weight: normal;\r\n    }\r\n    </style>\r\n    <![endif]-->\r\n    <style>\r\n     tbody tr {\r\n        background: #FFFFFF;\r\n        max-width: 800px;\r\n        height: 40px;\r\n    }\r\n    tbody td {\r\n        box-sizing: border-box;\r\n        padding-left: 30px;\r\n        padding-right: 30px;\r\n        border-bottom: #e5e5e5 1px solid;\r\n    }\r\n    </style>\r\n</head>\r\n<body class=\"bodyContent\" style=\"max-width: 800px;margin: 0 auto;font-family: Helvetica, Arial, sans-serif;font-size: 14px;line-height: 125%;\">\r\n<header>\r\n<p class=\"lead\" style=\"-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; orphans: 3; widows: 3; margin: 0 0 10px; margin-bottom: 20px; font-size: 14px; font-weight: 300; line-height: 125%; margin-top: 20px; max-width: 800px; font-family: Helvetica, Arial, sans-serif;\">Estimado(a) cliente:</p>\r\n<p class=\"lead\" style=\"-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; orphans: 3; widows: 3; margin: 0 0 10px; margin-bottom: 20px; font-size: 14px; font-weight: 300; line-height: 125%; margin-top: 20px; max-width: 800px; font-family: Helvetica, Arial, sans-serif;\">Grupo Mutual le comunica que su pago de servicio LIBERTYMOVILANTESMOVISTAR con fecha de vencimiento 02/10/2023, se registró el día [[FECHAPAGO]].</p>\r\n</header>\r\n<div id=\"ticketBody\" style=\"box-shadow: 5px 5px 10px #888888; margin-bottom: 20px;\">\r\n<table class=\"flatTable\" style=\"width: 100%; max-width: 800px; border-collapse: collapse; color: #6b6b6b; font-weight: normal;\"><!-- [if gte mso 9]>\r\n  <table id=\"tableForOutlook\">\r\n<![endif]-->\r\n<tbody>\r\n<tr class=\"titleTr\" style=\"background: #BC0000; max-width: 800px; height: 70px; color: #f6f3f7; border: 0px solid; font-weight: bold;\">\r\n<td class=\"titleTd\" style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">COMPROBANTE DE PAGO</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\" align=\"right\"><img class=\"flexibleImage\" src=\"https://gmapp.fi.cr/biblioteca//1/ImagenesNotificaciones//logo45.png\" style=\"width: 150px;\" /></td>\r\n</tr>\r\n<tr class=\"headingTr\" style=\"background: #D50000; max-width: 800px; height: 30px; color: #f6f3f7; font-size: 8pt; border: 0px solid; font-weight: bold;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">DESCRIPCIÓN</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">VALOR</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Nombre del cliente</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[NOMBRECLIENTE]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Nombre de la empresa</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">LIBERTYMOVILANTESMOVISTAR</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Nombre del convenio</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[NOMBRECONVENIO]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Número de recibo</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[NUMERORECIBO]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Moneda</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[MONEDA]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Número de transacción</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[IDTRANSACCION]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Número de comprobante</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[NUMEROCOMPROBANTE]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Servicio</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[SERVICIO]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Periodo de cobro</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[PERIODOCOBRO]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Fecha de pago</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">[[FECHAPAGO]]</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">Fecha de vencimiento</td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\">02/10/2023</td>\r\n</tr>\r\n<tr style=\"background: #FFFFFF; max-width: 800px; height: 40px;\">\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid;\"><b>Monto total</b></td>\r\n<td style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px; border-bottom: #e5e5e5 1px solid; text-align: right;\"><b>[[MONTOCOMPROBANTE]]</b></td>\r\n</tr>\r\n<!-- [if gte mso 9]>\r\n    </table>\r\n<![endif]--></tbody>\r\n</table>\r\n</div>\r\n<h4>Conceptos informativos</h4>\r\n<div id=\"ticketBody\" style=\"box-shadow: 5px 5px 10px #888888; margin-bottom: 20px;\">\r\n<table class=\"flatTable\" style=\"width: 100%; max-width: 800px; border-collapse: collapse; color: #6b6b6b; font-weight: normal;\"><!-- [if gte mso 9]>\r\n  <table id=\"tableForOutlook\">\r\n<![endif]-->\r\n<thead>\r\n<tr class=\"headingTr\" style=\"background: #D50000; max-width: 800px; height: 30px; color: #f6f3f7; font-size: 8pt; border: 0px solid; font-weight: bold;\"><th style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">CÓDIGO</th><th style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">DESCRIPCIÓN</th><th style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">VALOR</th></tr>\r\n</thead>\r\n<tbody>\r\n<tr><td valign=\"top\" width=\"601\" height=\"\">ab10</td><td valign=\"top\" width=\"601\" height=\"\">MontoTotalPagado</td><td valign=\"top\" width=\"601\" height=\"\">12,185.30</td></tr><tr><td valign=\"top\" width=\"601\" height=\"\">ab10</td><td valign=\"top\" width=\"601\" height=\"\">MontoTotalPagado</td><td valign=\"top\" width=\"601\" height=\"\">12,185.30</td></tr>\r\n</tbody>\r\n<!-- [if gte mso 9]>\r\n        </table>\r\n        <![endif]--></table>\r\n</div>\r\n<h4>Conceptos de pago</h4>\r\n<div id=\"ticketBody\" style=\"box-shadow: 5px 5px 10px #888888; margin-bottom: 20px;\">\r\n<table class=\"flatTable\" style=\"width: 100%; max-width: 800px; border-collapse: collapse; color: #6b6b6b; font-weight: normal;\"><!-- [if gte mso 9]>\r\n  <table id=\"tableForOutlook\">\r\n<![endif]-->\r\n<thead>\r\n<tr class=\"headingTr\" style=\"background: #D50000; max-width: 800px; height: 30px; color: #f6f3f7; font-size: 8pt; border: 0px solid; font-weight: bold;\"><th style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">CÓDIGO</th><th style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">DESCRIPCIÓN</th><th style=\"box-sizing: border-box; padding-left: 30px; padding-right: 30px;\">VALOR</th></tr>\r\n</thead>\r\n<tbody>\r\n<tr><td valign=\"top\" width=\"601\" height=\"\">12</td><td valign=\"top\" width=\"601\" height=\"\">ReferenciaSecuencia</td><td valign=\"top\" width=\"601\" height=\"\">5</td></tr><tr><td valign=\"top\" width=\"601\" height=\"\">13</td><td valign=\"top\" width=\"601\" height=\"\">ReferenciaFactNume</td><td valign=\"top\" width=\"601\" height=\"\">1000240100</td></tr>\r\n</tbody>\r\n<!-- [if gte mso 9]>\r\n    </table>\r\n<![endif]--></table>\r\n</div>\r\n<p class=\"lead\" style=\"-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; orphans: 3; widows: 3; margin: 0 0 10px; margin-bottom: 20px; font-size: 14px; font-weight: 300; line-height: 125%; margin-top: 20px; max-width: 800px; font-family: Helvetica, Arial, sans-serif;\"><em><strong>\"Servicio brindado mediante convenio con el Banco Nacional de Costa Rica\"</strong></em></p>\r\n<p class=\"lead\" style=\"-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; orphans: 3; widows: 3; margin: 0 0 10px; margin-bottom: 20px; font-size: 14px; font-weight: 300; line-height: 125%; margin-top: 20px; max-width: 800px; font-family: Helvetica, Arial, sans-serif;\">Este correo es de tipo informativo, por favor no responda a este mensaje.</p>\r\n<p class=\"lead\" style=\"-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; orphans: 3; widows: 3; margin: 0 0 10px; margin-bottom: 20px; font-size: 14px; font-weight: 300; line-height: 125%; margin-top: 20px; max-width: 800px; font-family: Helvetica, Arial, sans-serif;\"><small>Grupo Mutual® 2018. Todos los derechos reservados</small></p>\r\n<!-- [if gte mso 9]>\r\n            <\\body>\r\n        <![endif]-->\r\n<p></p>\r\n</body>\r\n</html>"
}

handler(data, {})